[env:esp32-c3-devkitm-1]
platform = espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; === CRITICAL: 16MB flash configuration ===
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
board_upload.offset_address = 0x10000
board_build.flash_mode = dio
board_build.flash_size = 16MB
board_build.partitions = partitions.csv

; Libraries - All dependencies pinned for reproducible builds
lib_deps =
    zinggjm/GxEPD2@^1.5.9
    bblanchon/ArduinoJson@^7.0.0
    mathieucarbou/ESPAsyncWebServer@^3.3.23
    mathieucarbou/AsyncTCP@^3.2.14
    bodmer/TJpg_Decoder@^1.1.0

; Build flags
build_unflags = -std=gnu++11
build_flags = 
    -std=gnu++17
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCONFIG_ESP_TASK_WDT_INIT=0
    -DSUMI_VERSION=\"1.4.2\"
    -Iinclude
    -Iinclude/plugins
    -Ilib/expat
    -Ilib/miniz
    -DXML_GE=0
    -DXML_CONTEXT_BYTES=1024
    -DHAVE_MEMMOVE=1
    ; ============================================
    ; CRITICAL: LARGER LOOP TASK STACK (32KB)
    ; Default is 8KB which is too small for EPUB parsing
    ; ============================================
    -DARDUINO_LOOP_STACK_SIZE=32768
    ; === ALL FEATURES ENABLED ===
    -DFEATURE_READER=1
    -DFEATURE_WIFI=1
    -DFEATURE_WEBSERVER=1
    -DFEATURE_FLASHCARDS=1
    -DFEATURE_WEATHER=1
    -DFEATURE_GAMES=1
    -DFEATURE_LOCKSCREEN=0
    -DFEATURE_BLUETOOTH=0
    -DFEATURE_EPUB_FOLDER=0
    ; === MEMORY DEBUGGING ===
    -DSUMI_MEM_DEBUG=1
    ; === ASYNCWEBSERVER RAM REDUCTION ===
    -DASYNCWEBSERVER_REGEX=0
    -DCONFIG_ASYNC_TCP_RUNNING_CORE=1
    -DCONFIG_ASYNC_TCP_USE_WDT=0
    -DCONFIG_ASYNC_TCP_STACK_SIZE=4096
    ; === ARDUINOJSON RAM REDUCTION ===
    -DARDUINOJSON_ENABLE_PROGMEM=1
    -DARDUINOJSON_DEFAULT_NESTING_LIMIT=5
    ; === COMPILER OPTIMIZATION ===
    -Os
